<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mapa - Radar Solidário</title>
  <link rel="stylesheet" href="CSS/mapa.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="logo">
      <img src="Imagens/logo.png" alt="Logo S.O.S Link" />
    </div>
    <nav>
      <a href="index.html">Início</a>
      <a href="mapa.html">Mapa</a>
      <a href="preciso-de-ajuda.html">Preciso de Ajuda</a>
      <a href="#">FAQ</a>
      <a href="#">Contato</a>
    </nav>
    <div class="login">
      <img src="Imagens/user-icon.png" alt="Login" />
    </div>
  </header>

  <!-- MAPA -->
  <main>
    <div id="map"></div>

    <!-- LEGENDA -->
    <section class="legenda">
      <p><span class="icon red"></span> Pessoa precisando de ajuda</p>
      <p><span class="icon blue"></span> Pessoa oferecendo ajuda</p>

      <div class="explicacao">
        <h3>Como usar o mapa:</h3>
        <p>
          Este mapa mostra solicitações e ofertas de ajuda em tempo real.<br />
          🔴 Marcadores vermelhos indicam pessoas que precisam de ajuda.<br />
          🔵 Marcadores azuis indicam pessoas que estão oferecendo ajuda.
        </p>
        <p>
          Ao abrir a página, será solicitada sua localização. Ela é usada apenas para exibir o mapa focado em sua cidade e mostrar os pedidos próximos.
        </p>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <div class="footer-coluna">
      <strong>Contato</strong>
      <p>exemplo@email.com</p>
      <p>+00 0000-0000</p>
    </div>
    <p class="copyright">
      © 2024 Radar Solidário - Todos os direitos reservados.
    </p>
  </footer>

  <!-- LEAFLET E SCRIPT -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([-23.55, -46.63], 12); // fallback padrão

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Ícones personalizados
    const iconeAjuda = L.icon({
      iconUrl: 'Imagens/icone vermelho.png',
      iconSize: [30, 30],
      iconAnchor: [15, 30],
      popupAnchor: [0, -30]
    });

    const iconeOferta = L.icon({
      iconUrl: 'Imagens/icone azul.png',
      iconSize: [30, 30],
      iconAnchor: [15, 30],
      popupAnchor: [0, -30]
    });

    // Centralizar mapa na localização do usuário
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const { latitude, longitude } = pos.coords;
          map.setView([latitude, longitude], 14);
        },
        () => {
          console.warn('Permissão de localização negada.');
        }
      );
    }

    // Carregar pedidos de ajuda do localStorage
    const pedidos = JSON.parse(localStorage.getItem('pedidosAjuda')) || [];

     pedidos.forEach((p) => {
  const icone = p.tipo === 'oferece' ? iconeOferta : iconeAjuda;
  L.marker([p.lat, p.lng], { icon: icone })
    .addTo(map)
    .bindPopup(`
      <div style="min-width: 220px;">
        <strong>👤 Nome:</strong> ${String(p.nome)}<br>
        <strong>📞 Telefone:</strong> ${String(p.telefone)}<br>
        <strong>🆘 Tipo(s) de ajuda:</strong> ${(p.tipos || []).join(', ')}<br>
        <strong>📝 Descrição:</strong><br> ${String(p.descricao || 'Sem descrição')}
      </div>
    `);
});
  </script>
</body>
</html>




